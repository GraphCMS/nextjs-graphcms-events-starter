{"ast":null,"code":"import _objectWithoutProperties from \"@babel/runtime-corejs2/helpers/esm/objectWithoutProperties\";\nimport _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nvar _jsxFileName = \"/Users/jmartin/Development/GraphCMS/Microsites/graphcms-events/src/pages/index.js\";\nvar __jsx = React.createElement;\nimport React from 'react';\nimport Link from 'next/link';\nimport Sponsors from '../components/Sponsors';\n\nconst {\n  GraphQLClient\n} = require('graphql-request');\n\nconst Wrapper = props => __jsx(\"section\", _extends({\n  className: \"container mx-auto px-6 py-12 lg:py-20\"\n}, props, {\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 8\n  },\n  __self: this\n}));\n\nconst Home = ({\n  futureEvents,\n  pastEvents,\n  globalSponsors\n}) => {\n  const next = futureEvents[0];\n  return __jsx(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 14\n    },\n    __self: this\n  }, __jsx(\"section\", {\n    className: \"bg-cover bg-purple-800 pb-32 pt-8\",\n    style: {\n      backgroundImage: `linear-gradient(rgba(107, 70, 193,0.85), rgba(107, 70, 193,0.5)), url(${next.image.url})`,\n      clipPath: 'polygon(0% 0%, 100% 0%, 100% 85%, 30% 85%, 30% 100%, 0% 85%)'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 15\n    },\n    __self: this\n  }, __jsx(Wrapper, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 23\n    },\n    __self: this\n  }, __jsx(Link, {\n    href: next.slug,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 24\n    },\n    __self: this\n  }, __jsx(\"a\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 25\n    },\n    __self: this\n  }, __jsx(\"article\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 26\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: \"z-10 relative px-4 self-center w-2/3\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 27\n    },\n    __self: this\n  }, __jsx(\"p\", {\n    className: \"text-white inline-block font-bold text-sm\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 28\n    },\n    __self: this\n  }, \"Up Next\"), __jsx(\"h1\", {\n    className: \"text-6xl font-bold leading-tight text-white\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 31\n    },\n    __self: this\n  }, next.title), __jsx(\"p\", {\n    className: \"text-xl font-bold pb-3 text-purple-200\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 34\n    },\n    __self: this\n  }, next.venue && next.venue.name)), __jsx(\"section\", {\n    className: \"flex flex-wrap\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 38\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: \"w-full md:w-1/2 text-white bg-gray-900 p-6\",\n    dangerouslySetInnerHTML: {\n      __html: next.description.html\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 39\n    },\n    __self: this\n  }))))))), __jsx(Wrapper, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 49\n    },\n    __self: this\n  }, __jsx(\"h2\", {\n    className: \"text-purple-800 text-4xl md:text-6xl font-bold mb-6\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 50\n    },\n    __self: this\n  }, \"Upcoming Events\"), __jsx(\"section\", {\n    className: \"flex flex-wrap overflow-hidden -mx-2\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 53\n    },\n    __self: this\n  }, futureEvents && futureEvents.slice(1).map((event, index) => {\n    return __jsx(Link, {\n      className: \"w-full md:w-1/2 px-2 mb-10\",\n      href: event.slug,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 57\n      },\n      __self: this\n    }, __jsx(\"a\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 58\n      },\n      __self: this\n    }, __jsx(\"article\", {\n      key: index,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 59\n      },\n      __self: this\n    }, __jsx(\"img\", {\n      src: event.image ? event.image.url : '',\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 60\n      },\n      __self: this\n    }), __jsx(\"h1\", {\n      className: \"font-bold text-gray-800 text-xl mb-2\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 61\n      },\n      __self: this\n    }, event.title), __jsx(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 64\n      },\n      __self: this\n    }, event.venue ? event.venue.name : 'TBD'))));\n  }))), __jsx(Sponsors, {\n    sponsors: globalSponsors,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72\n    },\n    __self: this\n  }));\n};\n\nHome.getInitialProps = async ctx => {\n  const query = `\n  fragment assetInfo on Asset {\n    handle\n    width\n    height\n    url\n  }\n\n  fragment venueInfo on Venue {\n    id\n    name\n    location {\n      lat: latitude\n      lng: longitude\n    }\n    street\n    city\n    postcode\n    country\n  }\n\n  fragment speakerInfo on Speaker {\n    name\n    headline\n    photo {\n      ...assetInfo\n    }\n  }\n\n  fragment talkInfo on Talk {\n    id\n    title\n    speaker {\n      ...speakerInfo\n    }\n  }\n\n  fragment trackInfo on Track {\n    id\n    title\n    mc {\n      ...speakerInfo\n    }\n    timeSlots(orderBy: start_ASC) {\n      id\n      start\n      end\n      talk {\n        ...talkInfo\n      }\n      sessionBreak: break {\n        title\n      }\n    }\n  }\n\n  fragment EventInfo on Event {\n    id\n    title\n    slug\n    start\n    image {\n      ...assetInfo\n    }\n    description {\n      html\n    }\n    tracks {\n      ...trackInfo\n    }\n    sponsors {\n      name\n      url\n      logo {\n        ...assetInfo\n      }\n    }\n    venue {\n      ...venueInfo\n    }\n  }\n\n  query {\n      globalSponsors: sponsors(where: {\n        type: GLOBAL\n      }) {\n        name\n        url\n        logo {\n          ...assetInfo\n        }\n      }\n      events {\n        ...EventInfo\n      }\n  }\n`;\n  const graphQLClient = new GraphQLClient(process.env.GRAPHCMS_ENDPOINT, {\n    credentials: 'include',\n    mode: 'cors',\n    headers: {\n      Authorization: `Bearer ${process.env.GATSBY_GRAPHCMS_TOKEN}`\n    }\n  });\n  const request = await graphQLClient.request(query);\n  const {\n    events,\n    globalSponsors\n  } = request;\n\n  if (events) {\n    let pastEvents = [];\n    let futureEvents = [];\n    const now = new Date();\n\n    const sortByStart = (a, b) => {\n      if (a.start < b.start) return -1;\n      if (a.start > b.start) return 1;\n      if (a.start === b.start) return 0;\n    };\n\n    const sortBySpeaker = (a, b) => {\n      if (a.name < b.name) return -1;\n      if (a.name > b.name) return 1;\n      if (a.name === b.name) return 0;\n    };\n\n    events.forEach(payload => {\n      const {\n        tracks,\n        sponsors,\n        venue\n      } = payload,\n            event = _objectWithoutProperties(payload, [\"tracks\", \"sponsors\", \"venue\"]);\n\n      if (new Date(event.start) < now) pastEvents.push(payload);\n      if (new Date(event.start) > now) futureEvents.push(payload);\n      const speakers = tracks.reduce((collector, currentTrack) => {\n        return [...collector, ...currentTrack.timeSlots.map(timeSlot => timeSlot.talk ? timeSlot.talk.speaker : null)].filter(Boolean).sort(sortBySpeaker).reduce((collector, current) => {\n          if (collector.length) {\n            if (current.name === collector[collector.length - 1].name) {\n              return collector;\n            } else {\n              return [...collector, current];\n            }\n          } else {\n            return [...collector, current];\n          }\n        }, []);\n      }, []);\n    });\n    pastEvents = pastEvents ? pastEvents.sort(sortByStart) : [];\n    futureEvents = futureEvents ? futureEvents.sort(sortByStart) : [];\n    return {\n      futureEvents,\n      pastEvents,\n      globalSponsors\n    };\n  }\n};\n\nexport default Home;","map":{"version":3,"sources":["/Users/jmartin/Development/GraphCMS/Microsites/graphcms-events/src/pages/index.js"],"names":["React","Link","Sponsors","GraphQLClient","require","Wrapper","props","Home","futureEvents","pastEvents","globalSponsors","next","backgroundImage","image","url","clipPath","slug","title","venue","name","__html","description","html","slice","map","event","index","getInitialProps","ctx","query","graphQLClient","process","env","GRAPHCMS_ENDPOINT","credentials","mode","headers","Authorization","GATSBY_GRAPHCMS_TOKEN","request","events","now","Date","sortByStart","a","b","start","sortBySpeaker","forEach","payload","tracks","sponsors","push","speakers","reduce","collector","currentTrack","timeSlots","timeSlot","talk","speaker","filter","Boolean","sort","current","length"],"mappings":"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","sourcesContent":["import React from 'react';\nimport Link from 'next/link';\nimport Sponsors from '../components/Sponsors';\n\nconst { GraphQLClient } = require('graphql-request');\n\nconst Wrapper = props => (\n  <section className=\"container mx-auto px-6 py-12 lg:py-20\" {...props} />\n);\n\nconst Home = ({ futureEvents, pastEvents, globalSponsors }) => {\n  const next = futureEvents[0];\n  return (\n    <React.Fragment>\n      <section\n        className=\"bg-cover bg-purple-800 pb-32 pt-8\"\n        style={{\n          backgroundImage: `linear-gradient(rgba(107, 70, 193,0.85), rgba(107, 70, 193,0.5)), url(${next.image.url})`,\n          clipPath:\n            'polygon(0% 0%, 100% 0%, 100% 85%, 30% 85%, 30% 100%, 0% 85%)',\n        }}\n      >\n        <Wrapper>\n          <Link href={next.slug}>\n            <a>\n              <article>\n                <div className=\"z-10 relative px-4 self-center w-2/3\">\n                  <p className=\"text-white inline-block font-bold text-sm\">\n                    Up Next\n                  </p>\n                  <h1 className=\"text-6xl font-bold leading-tight text-white\">\n                    {next.title}\n                  </h1>\n                  <p className=\"text-xl font-bold pb-3 text-purple-200\">\n                    {next.venue && next.venue.name}\n                  </p>\n                </div>\n                <section className=\"flex flex-wrap\">\n                  <div\n                    className=\"w-full md:w-1/2 text-white bg-gray-900 p-6\"\n                    dangerouslySetInnerHTML={{ __html: next.description.html }}\n                  />\n                </section>\n              </article>\n            </a>\n          </Link>\n        </Wrapper>\n      </section>\n      <Wrapper>\n        <h2 className=\"text-purple-800 text-4xl md:text-6xl font-bold mb-6\">\n          Upcoming Events\n        </h2>\n        <section className=\"flex flex-wrap overflow-hidden -mx-2\">\n          {futureEvents &&\n            futureEvents.slice(1).map((event, index) => {\n              return (\n                <Link className=\"w-full md:w-1/2 px-2 mb-10\" href={event.slug}>\n                  <a>\n                    <article key={index}>\n                      <img src={event.image ? event.image.url : ''} />\n                      <h1 className=\"font-bold text-gray-800 text-xl mb-2\">\n                        {event.title}\n                      </h1>\n                      <p>{event.venue ? event.venue.name : 'TBD'}</p>\n                    </article>\n                  </a>\n                </Link>\n              );\n            })}\n        </section>\n      </Wrapper>\n      <Sponsors sponsors={globalSponsors} />\n    </React.Fragment>\n  );\n};\n\nHome.getInitialProps = async ctx => {\n  const query = `\n  fragment assetInfo on Asset {\n    handle\n    width\n    height\n    url\n  }\n\n  fragment venueInfo on Venue {\n    id\n    name\n    location {\n      lat: latitude\n      lng: longitude\n    }\n    street\n    city\n    postcode\n    country\n  }\n\n  fragment speakerInfo on Speaker {\n    name\n    headline\n    photo {\n      ...assetInfo\n    }\n  }\n\n  fragment talkInfo on Talk {\n    id\n    title\n    speaker {\n      ...speakerInfo\n    }\n  }\n\n  fragment trackInfo on Track {\n    id\n    title\n    mc {\n      ...speakerInfo\n    }\n    timeSlots(orderBy: start_ASC) {\n      id\n      start\n      end\n      talk {\n        ...talkInfo\n      }\n      sessionBreak: break {\n        title\n      }\n    }\n  }\n\n  fragment EventInfo on Event {\n    id\n    title\n    slug\n    start\n    image {\n      ...assetInfo\n    }\n    description {\n      html\n    }\n    tracks {\n      ...trackInfo\n    }\n    sponsors {\n      name\n      url\n      logo {\n        ...assetInfo\n      }\n    }\n    venue {\n      ...venueInfo\n    }\n  }\n\n  query {\n      globalSponsors: sponsors(where: {\n        type: GLOBAL\n      }) {\n        name\n        url\n        logo {\n          ...assetInfo\n        }\n      }\n      events {\n        ...EventInfo\n      }\n  }\n`;\n\n  const graphQLClient = new GraphQLClient(process.env.GRAPHCMS_ENDPOINT, {\n    credentials: 'include',\n    mode: 'cors',\n    headers: {\n      Authorization: `Bearer ${process.env.GATSBY_GRAPHCMS_TOKEN}`,\n    },\n  });\n\n  const request = await graphQLClient.request(query);\n\n  const { events, globalSponsors } = request;\n\n  if (events) {\n    let pastEvents = [];\n    let futureEvents = [];\n\n    const now = new Date();\n\n    const sortByStart = (a, b) => {\n      if (a.start < b.start) return -1;\n      if (a.start > b.start) return 1;\n      if (a.start === b.start) return 0;\n    };\n\n    const sortBySpeaker = (a, b) => {\n      if (a.name < b.name) return -1;\n      if (a.name > b.name) return 1;\n      if (a.name === b.name) return 0;\n    };\n\n    events.forEach(payload => {\n      const { tracks, sponsors, venue, ...event } = payload;\n\n      if (new Date(event.start) < now) pastEvents.push(payload);\n      if (new Date(event.start) > now) futureEvents.push(payload);\n\n      const speakers = tracks.reduce((collector, currentTrack) => {\n        return [\n          ...collector,\n          ...currentTrack.timeSlots.map(timeSlot =>\n            timeSlot.talk ? timeSlot.talk.speaker : null\n          ),\n        ]\n          .filter(Boolean)\n          .sort(sortBySpeaker)\n          .reduce((collector, current) => {\n            if (collector.length) {\n              if (current.name === collector[collector.length - 1].name) {\n                return collector;\n              } else {\n                return [...collector, current];\n              }\n            } else {\n              return [...collector, current];\n            }\n          }, []);\n      }, []);\n    });\n\n    pastEvents = pastEvents ? pastEvents.sort(sortByStart) : [];\n    futureEvents = futureEvents ? futureEvents.sort(sortByStart) : [];\n\n    return { futureEvents, pastEvents, globalSponsors };\n  }\n};\n\nexport default Home;\n"]},"metadata":{},"sourceType":"module"}